<?xml version="1.0" encoding="UTF-8"?>
<Wix xmlns="http://wixtoolset.org/schemas/v4/wxs"
     xmlns:ui="http://wixtoolset.org/schemas/v4/wxs/ui">
  <Package Name="OpenSpeedy" 
           Manufacturer="OpenSpeedy" 
           Version="$(var.Version)" 
           UpgradeCode="12345678-1234-1234-1234-123456789012">
    
    <MajorUpgrade DowngradeErrorMessage="A newer version of OpenSpeedy is already installed." />
    <MediaTemplate EmbedCab="yes" />

    <!-- 添加标准 UI -->
    <ui:WixUI Id="WixUI_Minimal" />
    <UIRef Id="WixUI_ErrorProgressText" />

    <Feature Id="ProductFeature" Title="OpenSpeedy" Level="1">
      <ComponentGroupRef Id="ProductComponents" />
    </Feature>
  </Package>

  <Fragment>
    <StandardDirectory Id="ProgramFiles64Folder">
      <Directory Id="INSTALLFOLDER" Name="OpenSpeedy" />
    </StandardDirectory>
  </Fragment>

  <Fragment>
    <ComponentGroup Id="ProductComponents" Directory="INSTALLFOLDER">
      <Component Id="MainExecutable">
        <File Id="MainExecutable" Source="files\Speedy.exe" KeyPath="yes">
          <Shortcut Id="StartMenuShortcut" 
                   Directory="ProgramMenuFolder" 
                   Name="OpenSpeedy" 
                   WorkingDirectory="INSTALLFOLDER" 
                   Icon="SpeedyIcon" 
                   IconIndex="0" 
                   Advertise="yes" />
        </File>
      </Component>
      <Component Id="Bridge32" Guid="*">
        <File Id="Bridge32Exe" Source="files\bridge32.exe" KeyPath="yes" />
      </Component>
      <Component Id="Bridge64" Guid="*">
        <File Id="Bridge64Exe" Source="files\bridge64.exe" KeyPath="yes" />
      </Component>
      <Component Id="SpeedPatch32" Guid="*">
        <File Id="SpeedPatch32Dll" Source="files\speedpatch32.dll" KeyPath="yes" />
      </Component>
      <Component Id="SpeedPatch64" Guid="*">
        <File Id="SpeedPatch64Dll" Source="files\speedpatch64.dll" KeyPath="yes" />
      </Component>
    </ComponentGroup>
  </Fragment>

  <Fragment>
    <Icon Id="SpeedyIcon" SourceFile="files\Speedy.exe" />
  </Fragment>
</Wix>
